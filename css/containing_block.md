# Layout and the containing block

网上一些有趣有趣的回复。。

- 知识都在书上，干嘛要记笔记？

- finally i figure it out by myself...为什么会用英文？因为为了解决问题英语看多了，脱口而出…………

带着问题（有目的性）看文章：

1. 绝对定位元素参照的元素？

1. 绝对定位元素 offset（`top`, `right`, `bottom`, `left`） 设置百分比值的参照？

1. 给盒子设置 `width`, `height`, `padding`, `margin` 百分比值的参照？

## Box

When a user agent (such as your browser) lays out a document, it generates a box for every element. Each box is divided into four areas:

1. Content area
1. Padding area
1. Border area
1. Margin area

<!-- https://mdn.mozillademos.org/files/8685/boxmodel-(3).png -->

![box](https://d2mxuefqeaa7sj.cloudfront.net/s_B3933F1CAEB89DA4EDCA442D5BACE6682180AB23F892E68B39E5A56D2034679C_1496411178061_boxdim.png)

## Definition of containing block

The position and size of an element's box(es) are sometimes calculated relative to a certain rectangle, called the **containing block** of the element. The containing block of an element is defined as follows:

1. The containing block in which the **root element** lives is a rectangle called the **initial containing block**. For continuous media, it has the dimensions of the viewport and is anchored at the canvas origin; it is the page area for paged media. The `direction` property of the initial containing block is the same as for the root element.

1. For other elements, if the element's position is `relative` or `static`, the containing block is formed by the **content edge of the nearest block container ancestor box**.

1. If the element has `position: fixed`, the containing block is established by the viewport in the case of continuous media or the page area in the case of paged media.

1. If the element has `position: absolute`, the containing block is established by the nearest ancestor with a `position` of `absolute`, `relative` or `fixed`, in the following way:

   1. In the case that the ancestor is an **inline element**, the containing block is the **bounding box around the padding boxes of the first and the last inline boxes generated for that element**. In CSS 2.1, if the inline element is split across multiple lines, the containing block is undefined.

   1. Otherwise, the containing block is formed by the **padding edge of the ancestor**.

      If there is no such ancestor, the containing block is the initial containing block.

In paged media, an absolutely positioned element is positioned relative to its containing block ignoring any page breaks (as if the document were continuous). The element may subsequently be broken over several pages.

For absolutely positioned content that resolves to a position on a page other than the page being laid out (the current page), or resolves to a position on the current page which has already been rendered for printing, printers may place the content

- on another location on the current page,
- on a subsequent page, or
- may omit it.

Note that a block-level element that is split over several pages may have a different width on each page and that there may be device-specific limits.

With no positioning, the containing blocks (C.B.) in the following document:

```html
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
  <head>
    <title>Illustration of containing blocks</title>
  </head>
  <body id="body">
    <div id="div1">
      <p id="p1">This is text in the first paragraph...</p>
      <p id="p2">
        This is text <em id="em1"> in the <strong id="strong1">second</strong> paragraph.</em>
      </p>
    </div>
  </body>
</html>
```

are established as follows:

| For box generated by | C.B. is established by      |
| -------------------- | --------------------------- |
| html                 | initial C.B. (UA-dependent) |
| body                 | html                        |
| div1                 | body                        |
| p1                   | div1                        |
| p2                   | div1                        |
| em1                  | p2                          |
| strong1              | p2                          |

If we position `div1`:

```css
#div1 {
  position: absolute;
  left: 50px;
  top: 50px;
}
```

its containing block is no longer `body`; it becomes the initial containing block (since there are no other positioned ancestor boxes).

If we position `em1` as well:

```css
#div1 {
  position: absolute;
  left: 50px;
  top: 50px;
}

#em1 {
  position: absolute;
  left: 100px;
  top: 100px;
}
```

the table of containing blocks becomes:

| For box generated by | C.B. is established by      |
| -------------------- | --------------------------- |
| html                 | initial C.B. (UA-dependent) |
| body                 | html                        |
| div1                 | **initial C.B.**            |
| p1                   | div1                        |
| p2                   | div1                        |
| em1                  | **div1**                    |
| strong1              | **em1**                     |

By positioning `em1`, its containing block becomes the nearest positioned ancestor box (i.e., that generated by `div1`).

## Identifying the containing block

The process for identifying the containing block depends entirely on the value of the element's `position` property:

1. If the position property is `static`, `relative`, or `sticky`, the containing block is formed by **the edge of the content box of the nearest ancestor element** that is either a block container (such as an inline-block, block, or list-item element) or establishes a formatting context (such as a table container, flex container, grid container, or the block container itself).

1. If the position property is `absolute`, the containing block is formed by the edge of the padding box of the nearest ancestor element that has a position value other than `static` (`fixed`, `absolute`, `relative`, or `sticky`).

1. If the position property is `fixed`, the containing block is established by the viewport (in the case of continuous media) or the page area (in the case of paged media).

1. If the position property is `absolute` or `fixed`, the containing block may also be formed by the edge of the padding box of the nearest ancestor element that has the following:

   1. A transform or perspective value other than `none`
   1. A will-change value of `transform` or `perspective`
   1. A filter value other than `none` or a `will-change` value of `filter` (only works on Firefox).
   1. A contain value of `paint` (e.g. `contain: paint;`)

> **Note**: The containing block in which the root element (`<html>`) resides is a rectangle called the **initial containing block**. It has the dimensions of the viewport (for continuous media) or the page area (for paged media).

## Effects of the containing block

The size and position of an element are often impacted by its containing block. Percentage values that are applied to the `width`, `height`, `padding`, `margin`, and offset properties of an absolutely positioned element (i.e., which has its position set to `absolute` or `fixed`) are computed from the element's containing block.

## Calculating percentage values from the containing block

when certain properties are given a percentage value, the computed value depends on the element's containing block. The properties that work this way are **box model** properties and **offset** properties:

1. The `height`, `top`, and `bottom` properties compute percentage values from the height of the containing block.
1. The `width`, `left`, `right`, **`padding`**, and **`margin`** properties compute percentage values from the width of the containing block.

## References

[mdn](https://developer.mozilla.org/en-US/docs/Web/CSS/Containing_block)

[w3c](https://www.w3.org/TR/CSS2/visudet.html#containing-block-details)

[block-boxes](https://www.w3.org/TR/CSS22/visuren.html#block-boxes)
